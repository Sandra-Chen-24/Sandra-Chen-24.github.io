<!doctype html><html lang=zh-tw dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Custom Compute Class ğŸš« é™åˆ¶ ComputeClass çš„åç¨±é–‹é ­ä¸å¾—ç‚º gke æˆ– autopilot\nè‡ªå‹•æ›¿æ›ç‚ºæ›´é©åˆçš„ç¯€é»è¨­å®š [activeMigration]\nEnable NAP (Node auto-provisioning) per classï¼Œä¾ç…§ cluster ç‰ˆæœ¬è¨­å®šæ–¹å¼ä¸åŒ\nGKE 1.33.3-gke.1136000 ä»¥ä¸Šç‰ˆæœ¬ [nodePoolAutoCreation]\nGKE 1.33.3-gke.1136000 ä»¥ä¸‹ç‰ˆæœ¬:å•Ÿç”¨å¢é›†å±¤ç´šçš„ç¯€é»è‡ªå‹•ä½ˆå»ºåŠŸèƒ½ [Node auto-provisioning]\ncluster ç‰ˆæœ¬å¤§æ–¼è¦æ±‚ï¼Œä½† nodepool å°æ–¼è¦æ±‚ï¼Œè‡ªå‹•é•·å‡ºä¾†çš„ nodepool æœƒè·Ÿ cluster åŒç‰ˆæœ¬ ç‰ˆæœ¬ (Version)ï¼š é è¨­æƒ…æ³ä¸‹ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± ç‰ˆæœ¬æœƒè·Ÿéš¨å¢é›†çš„æ§åˆ¶é¢ç‰ˆæœ¬ å€åŸŸ (Zones)ï¼š å¦‚æœèª¿æ•´ Default node zones ç‚ºå¤šå€ï¼ˆå¦‚ a, b, cï¼‰ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± é€šå¸¸æœƒæ¶µè“‹é€™äº›å€åŸŸï¼Œ å› ç‚º GKE æœƒæ ¹æ“šå¢é›†é…ç½®ä¾†å»ºç«‹å°æ‡‰å€åŸŸçš„å—æ§åŸ·è¡Œå€‹é«”ç¾¤çµ„ (GKE Node Pool)ã€‚ é™¤éåœ¨ ComputeClass çš„ priorities ä¸­æœ‰æ˜ç¢ºé™åˆ¶ location.zonesï¼Œå¦å‰‡æœƒå„ªå…ˆéµå¾ªå¢é›†çš„å€åŸŸè¨­å®š apiVersion: cloud.google.com/v1 kind: ComputeClass metadata: name: accelerator spec: nodePoolAutoCreation: enabled: true priorities: - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-a" - "us-central1-b" whenUnsatisfiable: DoNotScaleUp å¦‚æœ CCC æ²’æœ‰æŒ‡å®š zone é‚£æœƒä¾ç…§ default node zonesï¼Œå»ºè­°å¯ä»¥é¡ä¼¼ä»¥ä¸‹é€™æ¨£å¯« # a å€ç”¨å®Œçš„è©±å°±æœƒfailback åˆ° b or c å€ apiVersion: cloud.google.com/v1 kind: ComputeClass metadata: name: accelerator-ai-preferred spec: nodePoolAutoCreation: enabled: true priorities: # --- Priority 1: --- - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-a" # Specify your target AI Zone # --- Priority 2: --- - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-b" - "us-central1-c" whenUnsatisfiable: DoNotScaleUp å®šç¾©è‡ªå‹•èª¿åº¦è³‡æºçš„é–€æª»å’Œåƒæ•¸ï¼Œä»¥ä¾¿ç§»é™¤æœªå……åˆ†åˆ©ç”¨çš„ç¯€é» [autoscalingPolicy]\n'><title>Custom Compute Class</title><link rel=canonical href=https://sandra-chen-24.github.io/blog/gcp/custom-compute-class/><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap"><link rel=stylesheet href=/scss/style.min.390cc81d180d80110703ea467e355a4f3a0f44f25d4e957842790824fb5f2ef2.css><meta property='og:title' content="Custom Compute Class"><meta property='og:description' content='Custom Compute Class ğŸš« é™åˆ¶ ComputeClass çš„åç¨±é–‹é ­ä¸å¾—ç‚º gke æˆ– autopilot\nè‡ªå‹•æ›¿æ›ç‚ºæ›´é©åˆçš„ç¯€é»è¨­å®š [activeMigration]\nEnable NAP (Node auto-provisioning) per classï¼Œä¾ç…§ cluster ç‰ˆæœ¬è¨­å®šæ–¹å¼ä¸åŒ\nGKE 1.33.3-gke.1136000 ä»¥ä¸Šç‰ˆæœ¬ [nodePoolAutoCreation]\nGKE 1.33.3-gke.1136000 ä»¥ä¸‹ç‰ˆæœ¬:å•Ÿç”¨å¢é›†å±¤ç´šçš„ç¯€é»è‡ªå‹•ä½ˆå»ºåŠŸèƒ½ [Node auto-provisioning]\ncluster ç‰ˆæœ¬å¤§æ–¼è¦æ±‚ï¼Œä½† nodepool å°æ–¼è¦æ±‚ï¼Œè‡ªå‹•é•·å‡ºä¾†çš„ nodepool æœƒè·Ÿ cluster åŒç‰ˆæœ¬ ç‰ˆæœ¬ (Version)ï¼š é è¨­æƒ…æ³ä¸‹ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± ç‰ˆæœ¬æœƒè·Ÿéš¨å¢é›†çš„æ§åˆ¶é¢ç‰ˆæœ¬ å€åŸŸ (Zones)ï¼š å¦‚æœèª¿æ•´ Default node zones ç‚ºå¤šå€ï¼ˆå¦‚ a, b, cï¼‰ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± é€šå¸¸æœƒæ¶µè“‹é€™äº›å€åŸŸï¼Œ å› ç‚º GKE æœƒæ ¹æ“šå¢é›†é…ç½®ä¾†å»ºç«‹å°æ‡‰å€åŸŸçš„å—æ§åŸ·è¡Œå€‹é«”ç¾¤çµ„ (GKE Node Pool)ã€‚ é™¤éåœ¨ ComputeClass çš„ priorities ä¸­æœ‰æ˜ç¢ºé™åˆ¶ location.zonesï¼Œå¦å‰‡æœƒå„ªå…ˆéµå¾ªå¢é›†çš„å€åŸŸè¨­å®š apiVersion: cloud.google.com/v1 kind: ComputeClass metadata: name: accelerator spec: nodePoolAutoCreation: enabled: true priorities: - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-a" - "us-central1-b" whenUnsatisfiable: DoNotScaleUp å¦‚æœ CCC æ²’æœ‰æŒ‡å®š zone é‚£æœƒä¾ç…§ default node zonesï¼Œå»ºè­°å¯ä»¥é¡ä¼¼ä»¥ä¸‹é€™æ¨£å¯« # a å€ç”¨å®Œçš„è©±å°±æœƒfailback åˆ° b or c å€ apiVersion: cloud.google.com/v1 kind: ComputeClass metadata: name: accelerator-ai-preferred spec: nodePoolAutoCreation: enabled: true priorities: # --- Priority 1: --- - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-a" # Specify your target AI Zone # --- Priority 2: --- - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-b" - "us-central1-c" whenUnsatisfiable: DoNotScaleUp å®šç¾©è‡ªå‹•èª¿åº¦è³‡æºçš„é–€æª»å’Œåƒæ•¸ï¼Œä»¥ä¾¿ç§»é™¤æœªå……åˆ†åˆ©ç”¨çš„ç¯€é» [autoscalingPolicy]\n'><meta property='og:url' content='https://sandra-chen-24.github.io/blog/gcp/custom-compute-class/'><meta property='og:site_name' content='Sandra Chen Blog'><meta property='og:type' content='article'><meta property='article:section' content='Blog'><meta property='article:tag' content='gke'><meta property='article:tag' content='cost'><meta property='article:published_time' content='2025-12-16T10:30:00+08:00'><meta property='article:modified_time' content='2025-12-16T10:30:00+08:00'><meta name=twitter:title content="Custom Compute Class"><meta name=twitter:description content='Custom Compute Class ğŸš« é™åˆ¶ ComputeClass çš„åç¨±é–‹é ­ä¸å¾—ç‚º gke æˆ– autopilot\nè‡ªå‹•æ›¿æ›ç‚ºæ›´é©åˆçš„ç¯€é»è¨­å®š [activeMigration]\nEnable NAP (Node auto-provisioning) per classï¼Œä¾ç…§ cluster ç‰ˆæœ¬è¨­å®šæ–¹å¼ä¸åŒ\nGKE 1.33.3-gke.1136000 ä»¥ä¸Šç‰ˆæœ¬ [nodePoolAutoCreation]\nGKE 1.33.3-gke.1136000 ä»¥ä¸‹ç‰ˆæœ¬:å•Ÿç”¨å¢é›†å±¤ç´šçš„ç¯€é»è‡ªå‹•ä½ˆå»ºåŠŸèƒ½ [Node auto-provisioning]\ncluster ç‰ˆæœ¬å¤§æ–¼è¦æ±‚ï¼Œä½† nodepool å°æ–¼è¦æ±‚ï¼Œè‡ªå‹•é•·å‡ºä¾†çš„ nodepool æœƒè·Ÿ cluster åŒç‰ˆæœ¬ ç‰ˆæœ¬ (Version)ï¼š é è¨­æƒ…æ³ä¸‹ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± ç‰ˆæœ¬æœƒè·Ÿéš¨å¢é›†çš„æ§åˆ¶é¢ç‰ˆæœ¬ å€åŸŸ (Zones)ï¼š å¦‚æœèª¿æ•´ Default node zones ç‚ºå¤šå€ï¼ˆå¦‚ a, b, cï¼‰ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± é€šå¸¸æœƒæ¶µè“‹é€™äº›å€åŸŸï¼Œ å› ç‚º GKE æœƒæ ¹æ“šå¢é›†é…ç½®ä¾†å»ºç«‹å°æ‡‰å€åŸŸçš„å—æ§åŸ·è¡Œå€‹é«”ç¾¤çµ„ (GKE Node Pool)ã€‚ é™¤éåœ¨ ComputeClass çš„ priorities ä¸­æœ‰æ˜ç¢ºé™åˆ¶ location.zonesï¼Œå¦å‰‡æœƒå„ªå…ˆéµå¾ªå¢é›†çš„å€åŸŸè¨­å®š apiVersion: cloud.google.com/v1 kind: ComputeClass metadata: name: accelerator spec: nodePoolAutoCreation: enabled: true priorities: - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-a" - "us-central1-b" whenUnsatisfiable: DoNotScaleUp å¦‚æœ CCC æ²’æœ‰æŒ‡å®š zone é‚£æœƒä¾ç…§ default node zonesï¼Œå»ºè­°å¯ä»¥é¡ä¼¼ä»¥ä¸‹é€™æ¨£å¯« # a å€ç”¨å®Œçš„è©±å°±æœƒfailback åˆ° b or c å€ apiVersion: cloud.google.com/v1 kind: ComputeClass metadata: name: accelerator-ai-preferred spec: nodePoolAutoCreation: enabled: true priorities: # --- Priority 1: --- - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-a" # Specify your target AI Zone # --- Priority 2: --- - gpu: type: nvidia-tesla-a100 count: 1 location: zones: - "us-central1-b" - "us-central1-c" whenUnsatisfiable: DoNotScaleUp å®šç¾©è‡ªå‹•èª¿åº¦è³‡æºçš„é–€æª»å’Œåƒæ•¸ï¼Œä»¥ä¾¿ç§»é™¤æœªå……åˆ†åˆ©ç”¨çš„ç¯€é» [autoscalingPolicy]\n'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column compact"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>Sandra Chen Blog</a></h1><h2 class=site-description>Notes & Writings</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/_index.zh-cn/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ</span></a></li><li><a href=/page/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/page/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/><span>Home</span></a></li><li><a href=/posts/><span>Posts</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/gcp/ style=background-color:#efbec0;color:#3d0f12>Gcp</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/blog/gcp/custom-compute-class/>Custom Compute Class</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-12-16T10:30:00+08:00>Tuesday, December 16, 2025</time></div></footer></div></header><section class=article-content><h2 id=custom-compute-class><a class=link href="https://docs.cloud.google.com/kubernetes-engine/docs/concepts/about-custom-compute-classes?hl=zh-tw#how-custom" target=_blank rel=noopener>Custom Compute Class</a></h2><ul><li><p>ğŸš« é™åˆ¶ ComputeClass çš„åç¨±é–‹é ­ä¸å¾—ç‚º gke æˆ– autopilot</p></li><li><p>è‡ªå‹•æ›¿æ›ç‚ºæ›´é©åˆçš„ç¯€é»è¨­å®š [activeMigration]</p></li><li><p>Enable NAP (Node auto-provisioning) per classï¼Œä¾ç…§ cluster ç‰ˆæœ¬è¨­å®šæ–¹å¼ä¸åŒ</p><ul><li><p>GKE 1.33.3-gke.1136000 ä»¥ä¸Šç‰ˆæœ¬ [nodePoolAutoCreation]</p></li><li><p>GKE 1.33.3-gke.1136000 ä»¥ä¸‹ç‰ˆæœ¬:å•Ÿç”¨å¢é›†å±¤ç´šçš„ç¯€é»è‡ªå‹•ä½ˆå»ºåŠŸèƒ½ [Node auto-provisioning]</p><ul><li>cluster ç‰ˆæœ¬å¤§æ–¼è¦æ±‚ï¼Œä½† nodepool å°æ–¼è¦æ±‚ï¼Œè‡ªå‹•é•·å‡ºä¾†çš„ nodepool æœƒè·Ÿ cluster åŒç‰ˆæœ¬</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>ç‰ˆæœ¬ (Version)ï¼š
</span></span><span style=display:flex><span>é è¨­æƒ…æ³ä¸‹ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± ç‰ˆæœ¬æœƒè·Ÿéš¨å¢é›†çš„æ§åˆ¶é¢ç‰ˆæœ¬
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>å€åŸŸ (Zones)ï¼š
</span></span><span style=display:flex><span>å¦‚æœèª¿æ•´ Default node zones ç‚ºå¤šå€ï¼ˆå¦‚ a, b, cï¼‰ï¼Œè‡ªå‹•ç”¢ç”Ÿçš„ç¯€é»æ± é€šå¸¸æœƒæ¶µè“‹é€™äº›å€åŸŸï¼Œ
</span></span><span style=display:flex><span>å› ç‚º GKE æœƒæ ¹æ“šå¢é›†é…ç½®ä¾†å»ºç«‹å°æ‡‰å€åŸŸçš„å—æ§åŸ·è¡Œå€‹é«”ç¾¤çµ„ (GKE Node Pool)ã€‚
</span></span><span style=display:flex><span>é™¤éåœ¨ ComputeClass çš„ priorities ä¸­æœ‰æ˜ç¢ºé™åˆ¶ location.zonesï¼Œå¦å‰‡æœƒå„ªå…ˆéµå¾ªå¢é›†çš„å€åŸŸè¨­å®š
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cloud.google.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ComputeClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>accelerator</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePoolAutoCreation</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>priorities</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>gpu</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>nvidia-tesla-a100</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>count</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>location</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>zones</span>:
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#34;us-central1-a&#34;</span>
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#34;us-central1-b&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>whenUnsatisfiable</span>: <span style=color:#ae81ff>DoNotScaleUp</span>
</span></span></code></pre></div><ul><li>å¦‚æœ CCC æ²’æœ‰æŒ‡å®š zone é‚£æœƒä¾ç…§ default node zonesï¼Œå»ºè­°å¯ä»¥é¡ä¼¼ä»¥ä¸‹é€™æ¨£å¯«</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># a å€ç”¨å®Œçš„è©±å°±æœƒfailback åˆ° b or c å€</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cloud.google.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ComputeClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>accelerator-ai-preferred</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePoolAutoCreation</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>priorities</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># --- Priority 1:  ---</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>gpu</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>nvidia-tesla-a100</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>count</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>location</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>zones</span>:
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#34;us-central1-a&#34;</span> <span style=color:#75715e># Specify your target AI Zone</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># --- Priority 2: ---</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>gpu</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>nvidia-tesla-a100</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>count</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>location</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>zones</span>:
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#34;us-central1-b&#34;</span>
</span></span><span style=display:flex><span>          - <span style=color:#e6db74>&#34;us-central1-c&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>whenUnsatisfiable</span>: <span style=color:#ae81ff>DoNotScaleUp</span>
</span></span></code></pre></div></li></ul></li><li><p>å®šç¾©è‡ªå‹•èª¿åº¦è³‡æºçš„é–€æª»å’Œåƒæ•¸ï¼Œä»¥ä¾¿ç§»é™¤æœªå……åˆ†åˆ©ç”¨çš„ç¯€é» [autoscalingPolicy]</p></li><li><p>ä½¿ç”¨é ç´„è³‡æº [reservations]</p></li><li><p>å…§å»ºçš„ ComputeClassï¼šåœ¨ Standard å¢é›†ä¸­åŸ·è¡Œ Autopilot æ¨¡å¼å·¥ä½œè² è¼‰ <a class=link href="https://docs.cloud.google.com/kubernetes-engine/docs/concepts/about-built-in-compute-classes?hl=zh-tw" target=_blank rel=noopener>é©ç”¨æ–¼ 1.34.1-gke.1829001 ä»¥ä¸Šç‰ˆæœ¬</a></p><ul><li>autopilot</li><li>autopilot-spot</li><li>å»ºç«‹è‡ªè¨‚ Autopilot ComputeClass</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>autopilot</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div></li><li><p>åœ¨å·¥ä½œè² è¼‰è³‡è¨Šæ¸…å–®ä¸­é¸å– ComputeClassï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ cloud.google.com/compute-class æ¨™ç±¤</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>nodeSelector</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Replace with the name of a compute class</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cloud.google.com/compute-class</span>: <span style=color:#ae81ff>COMPUTE_CLASS</span>
</span></span></code></pre></div><h3 id=activemigration>activeMigration</h3><ul><li>è‡ªå‹•ç”¢ç”Ÿçš„ node å‰ç¶´æœƒæ˜¯ nap- (for Node Auto-Provisioning)</li><li>é¸ç”¨è‡ªå‹•èª¿åº¦è³‡æºåŠŸèƒ½ï¼Œå¯è‡ªå‹•ä»¥æ–°ç¯€é»å–ä»£ç¾æœ‰ç¯€é»ã€‚ç¯€é»æœƒæ ¹æ“šç‰¹å®šæ¢ä»¶æ›¿æ›ï¼Œå…·é«”å–æ±ºæ–¼é·ç§»é¡å‹ï¼ŒGKE æœƒå»ºç«‹æ–°ç¯€é»ï¼Œç„¶å¾Œæ’ç©ºä¸¦åˆªé™¤èˆŠç¯€é»<ul><li>ğŸš« é·ç§»ä½œæ¥­ä¸æœƒé·ç§»å„²å­˜åœ¨æ°¸ä¹…å„²å­˜ç©ºé–“ä¸­çš„è³‡æ–™ï¼Œä¾‹å¦‚ Compute Engine æ°¸ä¹…ç£ç¢Ÿã€‚ç‚ºç›¡é‡é™ä½è³‡æ–™éºå¤±é¢¨éšªï¼Œè«‹å‹¿åœ¨æœ‰ç‹€æ…‹å·¥ä½œè² è¼‰ä½¿ç”¨çš„ ComputeClass ä¸­å•Ÿç”¨ä¸»å‹•é·ç§»åŠŸèƒ½</li><li>ğŸš« å¦‚æœç¯€é»ç„¡æ³•ç§»é™¤ï¼Œé€²è¡Œä¸­çš„é·ç§»ä½œæ¥­ä¸æœƒå–ä»£é€™äº›ç¯€é»ã€‚èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœä¸»å‹•é·ç§»æœƒé•å &ndash;min-nodes ç¯€é»é›†å€è¨­å®šï¼Œå°±ä¸æœƒå–ä»£ç¯€é»</li><li>ğŸš« ç‚ºé¿å…é‡è¦å·¥ä½œè² è¼‰ä¸­æ–·ï¼Œé·ç§»ä½œæ¥­ä¸æœƒç§»å‹•ä¸‹åˆ— Podï¼š<ul><li>è¨­å®š PodDisruptionBudget çš„ Podï¼Œå¦‚æœç§»å‹•ä½œæ¥­æœƒè¶…å‡º PodDisruptionBudget</li><li>å…·æœ‰ cluster-autoscaler.kubernetes.io/safe-to-evict: &ldquo;false&rdquo; è¨»è§£çš„ Pod</li></ul></li><li>æ”¯æ´çš„æœ‰æ•ˆé·ç§»é¡å‹å¦‚ä¸‹ï¼š<ul><li>optimizeRulePriorityï¼šä»¥å„ªå…ˆé †åºæ¸…å–®ä¸­è¼ƒé«˜çš„ç¯€é»ï¼Œå–ä»£ ComputeClass å„ªå…ˆé †åºæ¸…å–®ä¸­è¼ƒä½çš„ç¯€é»</li><li>ensureAllDaemonSetPodsRunningï¼šä»¥è¼ƒå¤§çš„ç¯€é»å–ä»£å…·æœ‰ç„¡æ³•æ’ç¨‹çš„ DaemonSet Pod çš„ç¯€é»ï¼Œé€™äº›ç¯€é»èƒ½å¤ åŸ·è¡Œæ‰€æœ‰å¿…è¦çš„ DaemonSet Pod</li></ul></li></ul></li></ul><h3 id=autoscalingpolicy>autoscalingPolicy</h3><ul><li>å¾®èª¿è§¸ç™¼ç¯€é»ç§»é™¤å’Œå·¥ä½œè² è¼‰æ•´ä½µçš„è³‡æºä½¿ç”¨ç‡ä¸è¶³é–€æª»</li><li>å¯ä»¥å¾®èª¿ä¸‹åˆ—åƒæ•¸ï¼š<ul><li>consolidationStrategyï¼š<ul><li>OptimizePriceï¼šGKE æœƒä¸æ–·æƒæå¢é›†ã€‚å¦‚æœç™¼ç¾æŠŠ Pod ç§»åˆ°æ›´ä¾¿å®œçš„æ©Ÿå™¨ï¼ˆä¾‹å¦‚å¾ On-demand ç§»åˆ° Spotï¼‰æˆ–ç¸®æ¸›ç¯€é»æ•¸é‡å¯ä»¥çœéŒ¢ï¼Œå®ƒå°±æœƒä¸»å‹•åŸ·è¡Œ</li><li>Disabledï¼šç¯€é»ä¸€æ—¦é•·å‡ºä¾†ï¼Œé™¤éä¸Šé¢å®Œå…¨æ²’ Pod äº†ï¼Œå¦å‰‡ä¸æœƒä¸»å‹•ç¸®ç·¨</li></ul></li><li>consolidationDelayMinutesï¼šGKE ç§»é™¤ä½¿ç”¨ç‡ä¸è¶³çš„ç¯€é»å‰ï¼Œç­‰å¾…çš„åˆ†é˜æ•¸ [é è¨­å€¼ï¼šé€šå¸¸ç‚º 15 åˆ†é˜]</li><li>consolidationThresholdï¼šCPU å’Œè¨˜æ†¶é«”çš„ä½¿ç”¨ç‡é–€æª»ï¼Œä»¥ç¯€é»å¯ç”¨è³‡æºçš„ç™¾åˆ†æ¯”è¡¨ç¤ºã€‚åªæœ‰åœ¨è³‡æºä½¿ç”¨ç‡ä½æ–¼é€™å€‹é–€æª»æ™‚ï¼ŒGKE æ‰æœƒè€ƒæ…®ç§»é™¤ç¯€é»</li></ul></li></ul><h3 id=whenunsatisfiable>whenUnsatisfiable</h3><ul><li>ScaleUpAnyway: ComputeClass å„ªå…ˆé †åºä¸­æ²’æœ‰çš„æ©Ÿå™¨ç³»åˆ—ï¼Œæœƒè§¸ç™¼ç¯€é»å»ºç«‹ä½œæ¥­ï¼ŒGKE 1.33 ä¹‹å‰çš„é è¨­å€¼</li><li>DoNotScaleUp: ComputeClass å„ªå…ˆé †åºä¸­æ²’æœ‰çš„æ©Ÿå™¨ç³»åˆ—ï¼Œä¸æœƒè§¸ç™¼ç¯€é»å»ºç«‹ä½œæ¥­ï¼ŒGKE 1.33 ä»¥ä¸Šç‰ˆæœ¬çš„é è¨­å€¼</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cloud.google.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ComputeClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: {{ <span style=color:#ae81ff>.name }}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>activeMigration</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>optimizeRulePriority</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePoolAutoCreation</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>priorities</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>nodepools</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>arm-default-pool</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>machineType</span>: <span style=color:#ae81ff>c4a-highmem-4</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>spot</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>machineType</span>: <span style=color:#ae81ff>n2-highmem-4</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>spot</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>machineType</span>: <span style=color:#ae81ff>c4a-highmem-4</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>machineType</span>: <span style=color:#ae81ff>n2-highmem-4</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>autoscalingPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>consolidationDelayMinutes</span>: <span style=color:#ae81ff>5</span>
</span></span></code></pre></div><h2 id=priorities><a class=link href="https://docs.cloud.google.com/kubernetes-engine/docs/concepts/about-custom-compute-classes?hl=zh-tw#priority-rules" target=_blank rel=noopener>priorities</a></h2><ul><li>machineFamily</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>priorities</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineFamily</span>: <span style=color:#ae81ff>n4</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spot</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>minCores</span>: <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>minMemoryGb</span>: <span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>storage</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>bootDiskKMSKey</span>: <span style=color:#ae81ff>projects/example/locations/us-central1/keyRings/example/cryptoKeys/key-1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secondaryBootDisks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>diskImageName</span>: <span style=color:#ae81ff>pytorch-mnist</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>project</span>: <span style=color:#ae81ff>k8s-staging-jobset</span>
</span></span></code></pre></div><ul><li>machineType</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>priorities</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineType</span>: <span style=color:#ae81ff>n4-standard-32</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spot</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>storage</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>bootDiskType</span>: <span style=color:#ae81ff>pd-balanced</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bootDiskSize</span>: <span style=color:#ae81ff>250</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>localSSDCount</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bootDiskKMSKey</span>: <span style=color:#ae81ff>projects/example/locations/us-central1/keyRings/example/cryptoKeys/key-1</span>
</span></span></code></pre></div><ul><li><p><a class=link href="https://docs.cloud.google.com/kubernetes-engine/docs/concepts/about-custom-compute-classes?hl=zh-tw#manual-node-pools" target=_blank rel=noopener>nodepools</a></p><ul><li>ğŸš« é€™å€‹æ¬„ä½åƒ…æ”¯æ´ GKE Standard æ¨¡å¼</li><li>æ‰‹å‹•å»ºç«‹çš„ nood pool è¦åŠ ä¸Š Kubernetes æ¨™ç±¤ & taint
cloud.google.com/compute-class: {ComputeClass}</li></ul></li><li><p><a class=link href=https://docs.cloud.google.com/kubernetes-engine/docs/reference/crds/computeclass#priorityDefaults target=_blank rel=noopener>priorityDefaults</a> [TODO]</p><ul><li>GKE 1.32.1-gke.1729000 ä»¥ä¸Šç‰ˆæœ¬</li></ul></li></ul><h3 id=reservations-todo><a class=link href="https://docs.cloud.google.com/compute/docs/instances/reservations-overview?hl=zh-tw" target=_blank rel=noopener>reservations</a> [TODO]</h3><ul><li>Cloud å€åŸŸçš„ç¡¬é«”å¯ç”¨æ€§ï¼Œå‰‡å¯ä»¥åœ¨è‡ªè¨‚ ComputeClass ä¸­è¨­å®šæ¯å€‹å‚™æ´å„ªå…ˆé †åºï¼Œè®“ GKE åœ¨å»ºç«‹æ–°ç¯€é»æ™‚ä½¿ç”¨é ç•™è³‡æºï¼Œâ­ é©ç”¨æ–¼ GKE 1.31.1-gke.2105000 ä»¥ä¸Šç‰ˆæœ¬<ul><li>å¿…é ˆä½¿ç”¨ç¯€é»é›†å€è‡ªå‹•å»ºç«‹åŠŸèƒ½ï¼ŒGKE æ‰èƒ½ä½¿ç”¨é ç•™è³‡æºå»ºç«‹æ–°ç¯€é»</li><li>åªæœ‰åœ¨å®šç¾© machineType æˆ– machineFamily æ™‚ï¼Œæ‰èƒ½ä½¿ç”¨é TPU é ç•™é …ç›®</li><li>è¨­å®šæœ¬æ©Ÿ SSD çš„ ComputeClass å¿…é ˆä½¿ç”¨ machineType å„ªå…ˆé †åºè¦å‰‡ï¼Œè€Œé machineFamilyï¼Œå¿…é ˆæ˜ç¢ºåŒ…å« localSSDCount: æ¬„ä½</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cloud.google.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ComputeClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>shared-specific-reservations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePoolAutoCreation</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>priorities</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineFamily</span>: <span style=color:#ae81ff>n4</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>reservations</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>specific</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>n4-shared-reservation</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>project</span>: <span style=color:#ae81ff>reservation-project</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>: <span style=color:#ae81ff>Specific â­ å¿…é ˆç‚º Specific</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineType</span>: <span style=color:#ae81ff>a3-highgpu-1g</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>storage</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>localSSDCount</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gpu</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>nvidia-h100-80gb</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>count</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>reservations</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>affinity</span>: <span style=color:#ae81ff>AnyBestEffort â­ ä»»ä½•ç›¸ç¬¦çš„é è¨‚</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineFamily</span>: <span style=color:#ae81ff>n4</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spot</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineFamily</span>: <span style=color:#ae81ff>n4</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>whenUnsatisfiable</span>: <span style=color:#ae81ff>DoNotScaleUp</span>
</span></span></code></pre></div><h3 id=nodepoolgroup-todo>nodePoolGroup [TODO]</h3><ul><li>å°‡å¤šå€‹ç¯€é»é›†å€åˆ†çµ„ç‚ºå–®ä¸€é‚è¼¯å–®å…ƒï¼Œç¨±ç‚ºã€Œé›†åˆã€ã€‚é€™å€‹åˆ†çµ„åŠŸèƒ½å¯è®“æ‚¨å°‡å…±ç”¨è¨­å®šå¥—ç”¨è‡³å¤šå€‹ç¯€é»é›†å€</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>NodePoolGroup ä¸»è¦ç”¨é€”åœ¨ TPU è¨“ç·´æˆ– HPC ç›¸é—œçš„ä»»å‹™ï¼Œç¢ºä¿ä¿ç®—åŠ›ã€ŒåŒé€²åŒå‡ºã€
</span></span><span style=display:flex><span>è¨­å®šæ–¹å¼ï¼šworkloadType: HIGH_THROUGHPUT æ­é… nodePoolGroup
</span></span><span style=display:flex><span>å‘Šè¨´ GKE é€™ç¾¤ Node Pools æ˜¯ç”Ÿå‘½å…±åŒé«”ï¼Œå¦‚æœéœ€è¦ç¶­è­·æˆ–èª¿åº¦ï¼ŒGKE æœƒå‚¾å‘è®“å®ƒå€‘ä¿æŒå…¨é«”åœ¨ç·šçš„ç‹€æ…‹ï¼Œå°‘äº†ä¸€éƒ¨åˆ†ç¯€é»å¯èƒ½å°è‡´æ•´å€‹è¨“ç·´ä»»å‹™å¡ä½
</span></span><span style=display:flex><span>å¦‚æœæ˜¯ä¸€èˆ¬ API æˆ– Microservice å…¶å¯¦ä¸ä¸€å®šæœƒç”¨åˆ°
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePoolGroup</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-tpu-collection</span>
</span></span></code></pre></div><h3 id=nodepoolconfig-todo><a class=link href="https://docs.cloud.google.com/kubernetes-engine/docs/concepts/about-custom-compute-classes?hl=zh-tw#node_pool_configuration" target=_blank rel=noopener>nodePoolConfig</a> [TODO]</h3><h3 id=é è¨­-computeclass><a class=link href="https://docs.cloud.google.com/kubernetes-engine/docs/how-to/run-pods-default-compute-classes?hl=zh-tw" target=_blank rel=noopener>é è¨­ ComputeClass</a></h3><ul><li><p>å¯ä»¥å°‡ GKE å¢é›†æˆ–ç‰¹å®šå‘½åç©ºé–“è¨­å®šç‚ºå…·æœ‰é è¨­ ComputeClass</p><ul><li>å°‡ ComputeClass è¨­ç‚ºå¢é›†å±¤ç´šçš„é è¨­å€¼ï¼Œå¢é›†å¿…é ˆåŸ·è¡Œ GKE 1.33.1-gke.1744000 ä»¥ä¸Šç‰ˆæœ¬</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cloud.google.com/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ComputeClass</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>priorities</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineFamily</span>: <span style=color:#ae81ff>n4</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>machineFamily</span>: <span style=color:#ae81ff>n2</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>whenUnsatisfiable</span>: <span style=color:#ae81ff>ScaleUpAnyway</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePoolAutoCreation</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>gcloud container clusters update CLUSTER_NAME \
</span></span><span style=display:flex><span>    --location=CONTROL_PLANE_LOCATION \
</span></span><span style=display:flex><span>    --enable-default-compute-class
</span></span></code></pre></div><ul><li>å°‡ ComputeClass è¨­ç‚ºå‘½åç©ºé–“å±¤ç´šçš„é è¨­å€¼ï¼Œä½†åƒ…é©ç”¨æ–¼é DaemonSet Podï¼Œå¢é›†å¿…é ˆåŸ·è¡Œ GKE 1.33.1-gke.1788000 ä»¥ä¸Šç‰ˆæœ¬</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>kubectl label namespaces NAMESPACE_NAME \
</span></span><span style=display:flex><span>  cloud.google.com/default-compute-class=COMPUTECLASS_NAME
</span></span></code></pre></div></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>âš ï¸ pod å»ºç«‹å¾Œé€™æ¨£åšä¸æœƒæœ‰ç•°å¸¸</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>æŠŠ deploy çš„ ComputeClass åˆªæ‰ â†’ ComputeClass ä¸å¯ç·¨è¼¯ï¼Œèª¿æ•´æ™‚å¯ä»¥æš«æ™‚åˆªé™¤</span>
</span></span><span style=display:flex><span>- <span style=color:#ae81ff>ComputeClass è¢«åˆªé™¤å¾Œï¼Œæ®˜ç•™çš„ node pool ä¸æœƒè‡ªå‹•æ¶ˆå¤±</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>â­ CCC è‡ªå‹•ç”¢ç”Ÿçš„ nodepool é è¨­ zone è·Ÿ cluster ä¸€è‡´ï¼Œä½†ç•¶è©² zone é•·ä¸å‡ºä¾†æ™‚ï¼Œæœƒé•·å…¶ä»–</span>
</span></span></code></pre></div><h2 id=resourceflavor><a class=link href=https://kueue.sigs.k8s.io/zh-cn/docs/concepts/resource_flavor/ target=_blank rel=noopener>ResourceFlavor</a></h2><ul><li>ç•¶ä¸å†åªæ˜¯å–®ç´”åœ°æƒ³è®“ Pod ã€Œæœ‰åœ°æ–¹è·‘ã€ï¼Œè€Œæ˜¯æƒ³è¦ç²¾ç´°åŒ–ç®¡ç†ä¸åŒé¡å‹çš„è¨ˆç®—è³‡æºï¼ˆå¦‚ GPU å‹è™Ÿã€Spot åŸ·è¡Œå€‹é«”ã€ä¸åŒ CPU æ¶æ§‹ï¼‰æ™‚ï¼Œå°±æœƒéœ€è¦ ResourceFlavor<ul><li><p>Kueue + ResourceFlavorï¼š åœ¨ä»»å‹™æ’éšŠéšæ®µå°±å…ˆæª¢æŸ¥æƒ³ç”¨çš„è³‡æºï¼Œå¦‚æœé…é¡æ»¿äº†ï¼Œä»»å‹™æœƒç›´æ¥åœ¨éšŠåˆ—ä¸­ç­‰å¾…ï¼Œè€Œä¸æ˜¯å»è·Ÿ K8s èª¿åº¦å™¨ç¡¬ç¢°ç¡¬ï¼Œæ¸›å°‘äº†å¢é›†å£“åŠ›ä¸¦æé«˜äº†å…¬å¹³æ€§</p><ul><li>é‡å° Spot è³‡æºèˆ‡ On-Demand è³‡æºçš„ Kueue é…ç½®ç¯„ä¾‹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Spot è³‡æº</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kueue.x-k8s.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ResourceFlavor</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>spot-flavor</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeLabels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cloud.google.com/gke-spot</span>: <span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#75715e># ç¢ºä¿ä»»å‹™åªæœƒè·‘åœ¨æ¨™è¨˜ç‚º Spot çš„ç¯€é»ä¸Š</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># On-Demand è³‡æº</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kueue.x-k8s.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ResourceFlavor</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#66d9ef>on</span>-<span style=color:#ae81ff>demand-flavor</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodeLabels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cloud.google.com/gke-spot</span>: <span style=color:#e6db74>&#34;false&#34;</span> <span style=color:#75715e># ç¢ºä¿ä»»å‹™è·‘åœ¨ä¸€èˆ¬ç¯€é»ä¸Š</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># å®šç¾© ClusterQueue (å…¨åŸŸé…é¡ç®¡ç†)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kueue.x-k8s.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterQueue</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>combined-cluster-queue</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespaceSelector</span>: {} <span style=color:#75715e># å…è¨±æ‰€æœ‰ namespace ä½¿ç”¨</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resourceGroups</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>coveredResources</span>: [<span style=color:#e6db74>&#34;cpu&#34;</span>, <span style=color:#e6db74>&#34;memory&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>flavors</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>spot-flavor </span> <span style=color:#75715e># æ”¾åœ¨ç¬¬ä¸€å€‹ï¼Œä»£è¡¨å„ªå…ˆä½¿ç”¨</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;cpu&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>nominalQuota</span>: <span style=color:#ae81ff>100</span> <span style=color:#75715e># Spot ç¸½å…±çµ¦ 100 æ ¸å¿ƒ</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;memory&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>nominalQuota</span>: <span style=color:#ae81ff>400Gi</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#66d9ef>on</span>-<span style=color:#ae81ff>demand-flavor</span> <span style=color:#75715e># æ”¾åœ¨ç¬¬äºŒå€‹ï¼Œä½œç‚ºå‚™æ´</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;cpu&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>nominalQuota</span>: <span style=color:#ae81ff>50</span>  <span style=color:#75715e># On-Demand è¼ƒè²´ï¼Œåªçµ¦ 50 æ ¸å¿ƒ</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;memory&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>nominalQuota</span>: <span style=color:#ae81ff>200Gi</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># ä½¿ç”¨(LocalQueue)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>kueue.x-k8s.io/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>LocalQueue</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>team-a-queue</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>team-a</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>clusterQueue</span>: <span style=color:#ae81ff>combined-cluster-queue</span>
</span></span></code></pre></div></li></ul></li></ul><h2 id=tfk8s>tfk8s</h2><ul><li>ç”¨é€”ï¼šæŠŠç¾æœ‰çš„ Kubernetes YAML è½‰æ›æˆ Terraform</li></ul><pre tabindex=0><code># ç›´æ¥å°‡ç¾æœ‰çš„ ComputeClass è½‰æˆ TF
kubectl get computeclass highmem-xxx -o yaml | tfk8s -m
</code></pre><h2 id=åƒè€ƒæ–‡ç« >åƒè€ƒæ–‡ç« </h2><p><a class=link href=https://medium.com/google-cloud/practical-guide-to-kueue-and-custom-compute-classes-85a3fe287487 target=_blank rel=noopener>Practical Guide to Kueue and Custom Compute Classes</a></p><p><a class=link href="https://docs.cloud.google.com/compute/docs/instances/committed-use-discounts-overview?hl=zh-tw#spend_based" target=_blank rel=noopener>Compute Flexible CRDs</a></p><p><a class=link href=https://github.com/vszal/gke-custom-compute-class-examples target=_blank rel=noopener>GKE Custom Compute Class Examples</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/gke/>Gke</a>
<a href=/tags/cost/>Cost</a></section></footer></article><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2025 -
2026 Sandra Chen Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=4.0.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><script type=module>
    import gallery from '\/ts\/gallery.js';

    const articleContent = document.querySelector('.article-content');
    const shouldLoad = articleContent && (articleContent.querySelectorAll('figure').length > 0 || articleContent.querySelectorAll('img.gallery-image').length > 0);
    
    if (shouldLoad) {
        gallery(articleContent);

        const PhotoSwipeLightbox = (await import("https:\/\/cdn.jsdelivr.net\/npm\/photoswipe@5.4.4\/dist\/photoswipe-lightbox.esm.min.js")).default;
        const styleHref = "https:\/\/cdn.jsdelivr.net\/npm\/photoswipe@5.4.4\/dist\/photoswipe.css";

        const styleTag = document.createElement('link');
        styleTag.rel = 'stylesheet';
        styleTag.href = styleHref;
        document.head.appendChild(styleTag);

        const lightbox = new PhotoSwipeLightbox({
            gallerySelector: '.article-content',
            childSelector: 'figure a.image-link',
            pswpModule: () => import("https:\/\/cdn.jsdelivr.net\/npm\/photoswipe@5.4.4\/dist\/photoswipe.esm.min.js")
        });
        lightbox.init();
    }
</script></main></div><script type=text/javascript src=/ts/main.acaf849f2b273f6a8368a58b001f336738d0c948d92e79b116467d0c7515f932.js defer></script></body></html>